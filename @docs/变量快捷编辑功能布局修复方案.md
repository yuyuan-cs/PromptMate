# 变量快捷编辑功能布局修复方案

## 问题描述

在Electron版本的PromptMate中，打开提示词编辑界面后显示正常，但是一点击变量编辑按钮，存在以下问题：
1. 内容超出界面边界，导致用户无法正常使用变量编辑功能
2. 当填写较长的变量名称时，右侧预览界面会突然变窄
3. 整个布局会被变量表单撑开，导致内容超出软件边界

## 问题分析

经过分析，问题的根本原因包括：

1. **VariableForm组件内容过多且复杂**：包含变量统计、变量填写表单、实时预览等多个Card组件，展开时占用大量垂直空间
2. **ScrollArea布局限制**：在PromptEditorModular中，ScrollArea设置为`h-full`，但当VariableForm内容展开时，可能导致布局计算出现问题
3. **PromptPreview组件中的布局叠加**：变量表单和内容预览区域叠加显示，没有合适的高度约束
4. **变量标签宽度约束缺失**：变量名称过长时，标签区域无限扩展，导致整个表单行超出容器宽度
5. **输入框和选择器布局问题**：缺乏合适的宽度约束和flex布局优化

## 修复方案

### 1. 优化PromptPreview组件布局 (src/components/PromptPreview.tsx)

- **改为flex垂直布局**：将根容器改为`h-full flex flex-col`，确保高度受限
- **变量表单区域优化**：
  - 设置为`flex-shrink-0`避免被压缩
  - 添加`max-h-[50vh] overflow-y-auto`限制最大高度
- **内容预览区域优化**：设置为`flex-1 overflow-hidden`占用剩余空间
- **图片和标签区域**：设置为`flex-shrink-0`确保不被压缩

### 2. 优化VariableForm组件布局 (src/components/VariableForm.tsx)

- **根容器优化**：添加`max-h-full overflow-hidden flex flex-col`约束
- **变量统计信息**：设置为`flex-shrink-0`固定高度
- **变量填写表单**：
  - 主容器设置为`flex-1 min-h-0 overflow-hidden`
  - Card内容设置为`flex-1 overflow-y-auto`实现内部滚动
  - 单个输入框限制最大高度`maxHeight: '120px'`
- **预览控制和实时预览**：
  - 控制按钮设置为`flex-shrink-0`
  - 预览内容添加`max-h-[200px] overflow-y-auto`限制高度

### 3. 优化PromptEditorModular组件 (src/components/PromptEditorModular.tsx)

- **内容容器高度**：为p-6容器添加`h-full`类名
- **PromptPreview组件**：传递`className="h-full"`确保高度继承

### 4. 修复变量标签宽度问题 (src/components/VariableForm.tsx)

- **变量标签区域优化**：
  - 设置最大宽度`max-w-[120px]`防止过度扩展
  - 添加`flex-shrink-0`避免被压缩
  - 使用`text-ellipsis overflow-hidden`处理长文本
  - 添加`title`属性显示完整变量名
- **表单行布局优化**：
  - 改为`flex items-start`对齐方式
  - 添加`w-full`确保容器宽度约束
- **输入框区域优化**：
  - 添加`min-w-0 max-w-full`防止宽度溢出
- **建议值选择器优化**：
  - 外层包装`flex-shrink-0`容器
  - 按钮添加`min-w-[40px]`确保最小宽度

### 5. 优化PromptPreview组件宽度约束 (src/components/PromptPreview.tsx)

- **根容器优化**：添加`overflow-hidden`防止内容溢出
- **变量表单容器**：添加`w-full min-w-0`确保宽度约束
- **VariableForm组件**：传递`className="w-full min-w-0"`

## 技术细节

### Flexbox布局策略
- `flex-1`：占用剩余空间
- `flex-shrink-0`：防止组件被压缩
- `min-h-0`：允许flex子项缩小到内容以下

### 滚动区域设计
- 外层ScrollArea保持原有功能
- 内层组件添加独立滚动区域
- 限制最大高度避免无限扩展

### 样式类名说明
- `overflow-hidden`：隐藏溢出内容
- `overflow-y-auto`：垂直方向自动滚动
- `max-h-[50vh]`：最大高度为视口高度的50%
- `max-h-[200px]`：最大高度200像素
- `min-w-0`：允许flex子项缩小到内容宽度以下
- `max-w-[120px]`：最大宽度120像素
- `flex-shrink-0`：防止flex子项被压缩
- `text-ellipsis`：文本溢出时显示省略号
- `w-full`：宽度100%
- `items-start`：flex子项顶部对齐

## 修复效果

修复后的变量编辑功能具有以下特点：

1. **布局不会溢出**：所有内容都被合理约束在可视区域内
2. **响应式设计**：在不同窗口尺寸下都能正常显示
3. **滚动体验良好**：各个区域都有独立的滚动功能
4. **保持功能完整性**：所有原有功能都得到保留
5. **长变量名处理**：变量标签有合适的宽度限制，过长时显示省略号
6. **预览界面稳定**：右侧预览界面宽度不会因变量输入而变化
7. **输入体验优化**：输入框和选择器有合理的布局约束

## 测试建议

1. **基本功能测试**：
   - 点击变量编辑按钮，确认界面不会溢出
   - 填写变量值，确认输入框正常工作
   - 切换预览显示/隐藏功能

2. **边界情况测试**：
   - 包含大量变量的提示词
   - 窗口调整到最小尺寸
   - 变量值输入长文本内容
   - 超长变量名的显示效果
   - 快速输入大量文本时的布局稳定性

3. **交互体验测试**：
   - 滚动各个区域确认流畅性
   - 快速切换变量编辑显示/隐藏
   - 在编辑和预览模式间切换

## 相关文件

- `src/components/PromptPreview.tsx`
- `src/components/VariableForm.tsx` 
- `src/components/PromptEditorModular.tsx`

## 备注

此修复方案保持了原有的功能完整性，仅优化了布局和样式，不涉及业务逻辑变更。所有修改都使用Tailwind CSS类名，保持了代码的一致性。
