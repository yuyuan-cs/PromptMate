# 内置标签和示例提示词多语言支持说明

## 问题分析
用户指出默认的内置标签也应该随着语言改变，经过检查发现：
1. 示例提示词中的标签需要多语言支持
2. 示例提示词本身也需要多语言版本
3. 语言切换时应该同时更新分类、提示词和标签

## 解决方案

### 1. 创建英文版示例提示词

#### 1.1 英文提示词数据 (`src/data/prompts.en.json`)
```json
[
  {
    "id": "1",
    "title": "Code Interpreter",
    "content": "Please explain the functionality and implementation principles of the following code using simple and understandable language:\n\n```\n[Paste your code here]\n```",
    "category": "development",
    "tags": ["code", "explanation", "programming"],
    "isFavorite": false,
    "version": 1
  },
  {
    "id": "2",
    "title": "Story Idea Generator",
    "content": "Please create a creative story that includes the following elements: [Element 1], [Element 2], and [Element 3]. The story type should be [Type], suitable for [Target Audience] to read.",
    "category": "creative",
    "tags": ["writing", "creativity", "story"],
    "isFavorite": true,
    "version": 1
  },
  // ... 更多示例提示词
]
```

### 2. 数据加载函数增强

#### 2.1 多语言提示词加载 (`src/lib/data.ts`)
```typescript
// 根据语言获取示例提示词
export const getSamplePrompts = (language: string = 'zh-CN'): Prompt[] => {
  const promptsData = language === 'en' ? samplePromptsDataEn : samplePromptsDataZh;
  return promptsData.map(p => ({
    ...p,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  }));
};

// 加载提示词
export const loadPrompts = (language: string = 'zh-CN'): Prompt[] => {
  try {
    const saved = localStorage.getItem(STORAGE_KEYS.PROMPTS);
    if (saved) {
      const savedPrompts = JSON.parse(saved);
      // 如果有保存的提示词，检查是否需要更新语言
      return updatePromptsLanguage(savedPrompts, language);
    }
    return getSamplePrompts(language);
  } catch (error) {
    console.error("加载提示词时出错:", error);
    return getSamplePrompts(language);
  }
};

// 更新提示词语言
const updatePromptsLanguage = (prompts: Prompt[], targetLanguage: string): Prompt[] => {
  const samplePrompts = getSamplePrompts(targetLanguage);
  
  // 创建示例提示词的映射
  const samplePromptMap = new Map(samplePrompts.map(prompt => [prompt.id, prompt]));
  
  // 更新现有提示词的语言
  return prompts.map(prompt => {
    const samplePrompt = samplePromptMap.get(prompt.id);
    if (samplePrompt) {
      // 如果是示例提示词，使用对应语言的标题、内容和标签
      return {
        ...prompt,
        title: samplePrompt.title,
        content: samplePrompt.content,
        tags: samplePrompt.tags
      };
    }
    // 用户自定义提示词保持原样
    return prompt;
  });
};
```

### 3. Hook层多语言支持

#### 3.1 usePrompts Hook增强 (`src/hooks/usePrompts.tsx`)
```typescript
// 监听语言变化，更新分类和提示词显示
useEffect(() => {
  const currentLanguage = i18n.language || 'zh-CN';
  
  // 如果使用localStorage模式，重新加载分类和提示词
  if (!dbState.useSqlite) {
    const updatedCategories = loadCategories(currentLanguage);
    const updatedPrompts = loadPrompts(currentLanguage);
    setCategories(updatedCategories);
    setPrompts(updatedPrompts);
    console.log(`语言切换到 ${currentLanguage}，更新分类和提示词显示`);
  } else {
    // 数据库模式的处理逻辑...
  }
}, [i18n.language, dbState.useSqlite]);

// 从localStorage加载数据（回退方案）
const loadDataFromLocalStorage = async () => {
  try {
    const currentLanguage = i18n.language || 'zh-CN';
    const localPrompts = loadPrompts(currentLanguage);
    const localCategories = loadCategories(currentLanguage);
    
    setPrompts(localPrompts);
    setCategories(localCategories);
    
    console.log(`从localStorage加载了 ${localPrompts.length} 个提示词和 ${localCategories.length} 个分类 (语言: ${currentLanguage})`);
  } catch (error) {
    console.error('从localStorage加载数据失败:', error);
  }
};
```

## 功能特性

### 1. 完整的多语言支持
- **示例提示词**：提供中英文版本的示例提示词
- **内置标签**：示例提示词中的标签自动切换语言
- **分类名称**：分类名称根据语言动态显示
- **用户数据**：用户自定义的提示词和标签保持不变

### 2. 智能语言更新
- **示例数据更新**：内置示例提示词的标题、内容和标签自动更新
- **用户数据保护**：用户创建的提示词不受语言切换影响
- **标签同步**：内置标签与示例提示词保持同步

### 3. 双模式兼容
- **localStorage模式**：重新加载对应语言的数据
- **数据库模式**：动态更新显示语言
- **无缝切换**：语言切换时所有相关数据同步更新

## 标签对比示例

### 中文标签
```json
{
  "tags": ["代码", "解释", "编程", "写作", "创意", "故事", "邮件", "商务", "沟通"]
}
```

### 英文标签
```json
{
  "tags": ["code", "explanation", "programming", "writing", "creativity", "story", "email", "business", "communication"]
}
```

## 数据流程

### 1. 语言切换流程
```
用户切换语言 → Hook监听变化 → 加载对应语言数据 → 更新分类和提示词 → 更新标签显示
```

### 2. 数据更新策略
```
示例提示词 → 使用对应语言的完整数据
用户提示词 → 保持原有数据不变
内置标签 → 跟随示例提示词更新
```

### 3. 错误处理
```
加载失败 → 使用默认语言数据 → 记录错误日志 → 保持功能可用
```

## 测试验证

### 1. 语言切换测试
- ✅ 示例提示词标题和内容正确更新
- ✅ 内置标签正确切换语言
- ✅ 分类名称正确更新
- ✅ 用户自定义数据保持不变

### 2. 数据一致性测试
- ✅ 标签与提示词内容匹配
- ✅ 分类与提示词分类一致
- ✅ 多语言数据完整性

### 3. 兼容性测试
- ✅ localStorage模式正常工作
- ✅ 数据库模式正常工作
- ✅ 现有用户数据不受影响

## 相关文件
- `src/data/prompts.zh.json` - 中文示例提示词
- `src/data/prompts.en.json` - 英文示例提示词
- `src/lib/data.ts` - 数据加载和语言处理逻辑
- `src/hooks/usePrompts.tsx` - Hook层多语言支持

## 实现时间
2024年12月19日

## 状态
✅ 已实现并测试通过

## 总结
现在内置标签和示例提示词都完全支持多语言功能：

1. **示例提示词多语言**：提供中英文版本的示例提示词
2. **内置标签多语言**：标签自动跟随语言切换
3. **智能数据更新**：示例数据更新，用户数据保护
4. **完整语言支持**：分类、提示词、标签全部支持多语言

用户切换语言时，所有内置内容（分类、提示词、标签）都会自动更新为对应语言的版本，而用户自定义的内容保持不变。
