# 删除分类对话框标题修复说明

## 问题描述

用户反馈控制台中出现可访问性警告：
- `DialogContent` requires a `DialogTitle` for the component to be accessible for screen reader users
- Warning: Missing `Description` or `aria-describedby={undefined}` for `{DialogContent}`

这些警告表明删除分类对话框缺少标题，影响了屏幕阅读器用户的可访问性。

## 问题分析

通过代码分析发现，在 `src/components/Sidebar.tsx` 组件中，`handleDelete` 函数调用 `showConfirm` 时，标题参数被设置为空字符串：

```typescript
showConfirm(
  t("sidebar.message.deleteCategory"),
  "", // 标题为空字符串
  () => { confirmed = true; resolve(); },
  () => { confirmed = false; resolve(); }
);
```

这导致 `useSidebarAlert` hook 中的 `AlertComponent` 渲染时没有标题，触发了可访问性警告。

## 修复方案

### 1. 修改 Sidebar 组件

将 `showConfirm` 调用中的空标题参数替换为合适的标题：

```typescript
// 修复前
showConfirm(
  t("sidebar.message.deleteCategory"),
  "", // 空标题
  () => { confirmed = true; resolve(); },
  () => { confirmed = false; resolve(); }
);

// 修复后
showConfirm(
  t("sidebar.message.deleteCategory"),
  t("common.confirmDelete"), // 使用确认删除标题
  () => { confirmed = true; resolve(); },
  () => { confirmed = false; resolve(); }
);
```

### 2. 使用的国际化文本

- **消息内容**: `t("sidebar.message.deleteCategory")` - "确定要删除这个分类吗？"
- **对话框标题**: `t("common.confirmDelete")` - "确认删除"

## 修复效果

### 可访问性改进
- ✅ 删除分类对话框现在有明确的标题
- ✅ 屏幕阅读器用户可以正确识别对话框的用途
- ✅ 消除了控制台中的可访问性警告

### 用户体验改进
- ✅ 对话框标题更加清晰明确
- ✅ 保持了与系统其他确认对话框的一致性
- ✅ 支持国际化，多语言环境下都有合适的标题
- ✅ 修复了按钮点击无响应的问题

## 后续修复

### 按钮点击问题修复

在修复标题问题后，发现删除分类对话框的确定和取消按钮点击无响应。经过分析发现：

**问题根因**：
- `useSidebarAlert` hook 使用的是普通的 `Dialog` 组件
- 而系统中其他确认对话框都使用 `AlertDialog` 组件
- `AlertDialog` 有特殊的按钮处理机制，使用 `AlertDialogAction` 和 `AlertDialogCancel`

**修复方案**：
将 `useSidebarAlert` 中的 `Dialog` 组件替换为 `AlertDialog` 组件：

```typescript
// 修复前：使用普通Dialog
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';

// 修复后：使用AlertDialog
import { 
  AlertDialog, 
  AlertDialogContent, 
  AlertDialogHeader, 
  AlertDialogTitle, 
  AlertDialogDescription, 
  AlertDialogFooter,
  AlertDialogAction,
  AlertDialogCancel
} from '@/components/ui/alert-dialog';
```

**组件结构调整**：
```typescript
// 修复前
<Dialog open={state.open} onOpenChange={(o) => !o && close()}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>{state.title}</DialogTitle>
      <DialogDescription>{state.message}</DialogDescription>
    </DialogHeader>
    <div className="mt-4 flex justify-end gap-2">
      <Button onClick={...}>确定</Button>
    </div>
  </DialogContent>
</Dialog>

// 修复后
<AlertDialog open={state.open} onOpenChange={(open) => {
  if (!open) {
    close();
  }
}}>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>{state.title}</AlertDialogTitle>
      <AlertDialogDescription>{state.message}</AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel onClick={handleCancel}>取消</AlertDialogCancel>
      <AlertDialogAction onClick={handleConfirm}>确定</AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

**关键修复点**：
1. **事件处理函数**：创建独立的`handleConfirm`和`handleCancel`函数
2. **状态管理**：在事件处理函数中先调用回调，再关闭对话框
3. **组件行为**：让`AlertDialogCancel`和`AlertDialogAction`的默认行为与自定义逻辑配合

## 技术细节

### 相关文件
- `src/components/Sidebar.tsx` - 主要修复文件
- `src/hooks/useSidebarAlert.tsx` - 对话框组件实现
- `src/i18n/locales/zh-CN.json` - 国际化文本

### 修复位置
```typescript
// src/components/Sidebar.tsx 第374-379行
showConfirm(
  t("sidebar.message.deleteCategory"),
  t("common.confirmDelete"), // 新增标题
  () => { confirmed = true; resolve(); },
  () => { confirmed = false; resolve(); }
);
```

## 验证方法

1. **功能验证**：
   - 在侧边栏中右键点击分类
   - 选择"删除分类"
   - 确认对话框显示标题"确认删除"

2. **可访问性验证**：
   - 打开浏览器开发者工具控制台
   - 执行删除分类操作
   - 确认没有可访问性警告

3. **国际化验证**：
   - 切换语言环境
   - 确认标题在不同语言下都正确显示

## 注意事项

- 此修复仅影响主应用，浏览器扩展中的类似问题需要单独处理
- 修复保持了现有的功能逻辑不变
- 使用了系统统一的确认删除标题，保持UI一致性
