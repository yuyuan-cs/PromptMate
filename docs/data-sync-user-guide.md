# PromptMate 数据同步用户指南

## 概述

PromptMate 数据同步功能让您在桌面应用和浏览器扩展之间无缝同步提示词、分类和设置，确保您在不同平台上的数据始终保持一致。

## 功能特性

### ✨ 实时同步
- 桌面端和浏览器扩展之间的实时数据同步
- 自动检测数据变更并立即同步
- 支持提示词、分类、设置的完整同步

### 📁 多种同步方式
- **Native Messaging 同步**：通过 Chrome 原生消息机制实现实时同步
- **文件同步**：通过共享文件夹实现跨设备同步
- **手动导入导出**：支持 JSON 格式的数据备份和迁移

### 🔄 智能冲突解决
- 自动检测数据冲突
- 提供三种解决方案：本地优先、远程优先、智能合并
- 可视化对比界面，帮助您做出最佳选择

### 🛡️ 数据安全
- 本地文件存储，数据完全在您的设备上
- 自动备份机制，防止数据丢失
- 校验和验证，确保数据完整性

## 安装配置

### 方式一：Native Messaging 同步（推荐）

#### 1. 桌面端配置
桌面应用会自动安装和配置同步功能，无需额外操作。

#### 2. 浏览器扩展配置
1. **安装 Native Host**
   - 首次使用时，扩展会提示安装 Native Host 程序
   - 点击"安装"按钮，按照提示完成安装
   - 安装完成后重启浏览器

2. **验证连接**
   - 打开浏览器扩展
   - 查看右上角的同步状态指示器
   - 绿色圆圈表示连接成功

### 方式二：文件同步

#### 1. 设置共享文件夹
1. **选择同步文件夹**
   - 在桌面端设置中选择"文件同步"
   - 选择一个共享文件夹（如 Dropbox、OneDrive、Google Drive）
   - 或选择本地网络共享文件夹

2. **配置同步路径**
   - 桌面端：设置 → 数据同步 → 文件同步路径
   - 浏览器扩展：设置 → 同步设置 → 文件同步路径
   - 确保两端指向同一个文件夹

#### 2. 启用文件监听
- 系统会自动监听文件变化
- 支持实时同步和定时同步
- 可设置同步间隔（建议 30 秒）

### 方式三：手动导入导出

#### 1. 导出数据
1. 在任一端选择"导出数据"
2. 选择导出格式（JSON）
3. 保存到指定位置

#### 2. 导入数据
1. 在目标端选择"导入数据"
2. 选择之前导出的文件
3. 确认导入并合并数据

## 使用方法

### 同步状态查看

#### 桌面端
- 在主界面右上角查看同步状态图标
- 🟢 绿色：已连接并同步
- 🟡 黄色：存在冲突需要解决
- 🔴 红色：连接错误或同步失败
- ⚪ 灰色：同步已禁用

#### 浏览器扩展
- 在侧边栏顶部查看同步状态
- 点击状态图标可查看详细信息

### 手动同步

如果需要立即同步数据：

1. 点击同步状态图标
2. 选择"手动同步"
3. 等待同步完成提示

### 冲突解决

当检测到数据冲突时：

1. **冲突提示**
   - 系统会显示冲突通知
   - 同步状态变为黄色警告

2. **查看冲突详情**
   - 点击"解决冲突"按钮
   - 查看本地和远程数据的对比

3. **选择解决方案**
   - **使用本地数据**：保留当前设备的数据
   - **使用远程数据**：采用另一设备的数据
   - **智能合并**：自动合并两边的数据

## 同步设置

### 桌面端设置

1. 打开设置界面
2. 找到"数据同步"选项
3. 可配置：
   - **同步方式选择**：Native Messaging / 文件同步 / 手动同步
   - **文件同步路径**：设置共享文件夹位置
   - **同步间隔**：文件同步的检查频率
   - **冲突解决策略**：自动解决方式
   - **备份设置**：自动备份频率和保留数量

### 浏览器扩展设置

1. 点击同步状态图标
2. 选择"同步设置"
3. 可配置：
   - **同步方式**：选择 Native Messaging 或文件同步
   - **文件同步路径**：与桌面端保持一致
   - **同步间隔**：文件监听频率
   - **显示同步状态**：状态栏显示选项
   - **自动解决冲突**：冲突处理策略

## 常见问题

### Q: 同步状态显示"未连接"怎么办？

**A: 请按以下步骤排查：**
1. 确认桌面应用正在运行
2. 检查 Native Host 是否正确安装
3. 重启浏览器和桌面应用
4. 查看错误日志获取详细信息

### Q: 数据同步后丢失了部分内容？

**A: 数据恢复方法：**
1. 检查自动备份文件
2. 使用"智能合并"解决冲突
3. 从最近的备份恢复数据

### Q: 同步速度很慢怎么办？

**A: 优化建议：**
1. 减少同步频率设置
2. 清理不必要的历史数据
3. 检查系统资源使用情况

### Q: 文件同步和 Native Messaging 同步有什么区别？

**A: 两种方式的对比：**

| 特性 | Native Messaging | 文件同步 |
|------|------------------|----------|
| **实时性** | 实时同步 | 定时同步（可配置间隔） |
| **跨设备** | 仅限同一台电脑 | 支持多台设备 |
| **网络依赖** | 无需网络 | 需要共享文件夹访问 |
| **设置复杂度** | 简单，自动配置 | 需要配置共享路径 |
| **适用场景** | 单机多浏览器 | 多设备同步 |

### Q: 如何禁用数据同步？

**A: 禁用步骤：**
1. 在桌面端设置中关闭同步
2. 或在浏览器扩展中禁用同步
3. 数据将仅在本地存储

## 数据存储位置

### 桌面端
- **Windows**: `%APPDATA%\PromptMate\sync-data.json`
- **macOS**: `~/Library/Application Support/PromptMate/sync-data.json`
- **Linux**: `~/.config/promptmate/sync-data.json`

### 浏览器扩展
- 使用 Chrome 扩展本地存储
- 数据通过 Native Host 与桌面端同步

## 备份与恢复

### 自动备份
- 系统自动创建数据备份
- 默认保留最近 5 个备份文件
- 备份文件位于 `backups/` 目录

### 手动备份
1. 复制同步数据文件
2. 保存到安全位置
3. 需要时可手动恢复

### 数据恢复
1. 停止同步服务
2. 用备份文件替换当前数据文件
3. 重启应用恢复数据

## 安全注意事项

### 数据隐私
- 所有数据仅在本地设备间同步
- 不会上传到任何云服务
- 您完全控制自己的数据

### 网络安全
- 使用本地进程间通信
- 不涉及网络传输
- 无需担心网络安全问题

### 访问权限
- Native Host 仅允许指定扩展访问
- 使用系统级权限控制
- 定期检查访问日志

## 故障排除

### 重新安装 Native Host

如果同步功能完全无法使用：

```bash
# 卸载现有 Native Host
node scripts/install-native-host.js uninstall

# 重新安装
node scripts/install-native-host.js install

# 验证安装
node scripts/install-native-host.js check
```

### 重置同步数据

如果数据损坏需要重置：

1. 备份重要数据
2. 删除同步数据文件
3. 重启应用重新初始化

### 查看日志

获取详细错误信息：

1. 打开开发者工具
2. 查看控制台日志
3. 搜索同步相关错误

## 技术支持

如果遇到无法解决的问题：

1. 收集错误日志和系统信息
2. 描述问题复现步骤
3. 提供同步配置信息
4. 联系技术支持团队

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基础数据同步
- 实现冲突检测和解决

### 未来计划
- 支持更多浏览器
- 云端备份选项
- 团队协作功能
- 版本历史管理

---

**提示**: 数据同步功能会持续改进，建议定期更新到最新版本以获得最佳体验。
